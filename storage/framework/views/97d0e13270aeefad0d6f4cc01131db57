<?php $__env->startSection('css'); ?>
    <link href="<?php echo e(url('css/master/styles.css')); ?>" rel="stylesheet">
<?php $__env->stopSection(); ?>

<?php $__env->startSection('header-top'); ?>
    <?php echo $__env->make('public.layouts.header.header-top', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<?php $__env->stopSection(); ?>
<?php $__env->startSection('header-middle'); ?>
    <?php echo $__env->make('public.layouts.header.header-middle', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('content'); ?>

<!-- Main -->
<div class="container main" style="min-height: 500px;">
    <div class="row">
        <ul class="nav nav-tabs">
            <li role="presentation" class="active"><a href="<?php echo e(url('master/manage')); ?>">Manage Course</a></li>
            <li role="presentation"><a href="<?php echo e(url('master/create-course')); ?>">Create Course</a></li>
            <li role="presentation"><a href="javascript:void(0)">Edit Course</a></li>
            <li role="presentation"><a href="<?php echo e(url('user/editprofile')); ?>">Profile</a></li>
        </ul>
        <div class="col-sm-12" style="margin-top: 20px;">
            <div class="row">
                <div class="panel panel-info">
                    <div class="panel-heading" style="text-align: center;">
                        Your Courses
                    </div>
                    <div class="panel-body" style="min-height: 200px;">
                        <?php if($usercreatecourses->count() > 0): ?>
                            <?php foreach($usercreatecourses as $usercreatecourse): ?>
                                <div class="col-sm-3">
                                    <div class="product-image-wrapper">
                                        <div class="single-products">
                                            <div class="productinfo text-center">
                                                <a href="javascript:void(0)" class="thumbnail">
                                                    <img src="/<?php echo e($usercreatecourse->course->image->path); ?>" alt="<?php echo e($usercreatecourse->course->image->img_name); ?>" style="height: 240px;">
                                                </a>
                                                <h2><?php echo e($usercreatecourse->course->course_name); ?></h2>
                                                <ul class="nav nav-pills nav-justified">
                                                    <li>
                                                        <h5>
                                                            <a href="javascript:void(0)"><i class="glyphicon glyphicon-user"></i>
                                                                <?php echo e($usercreatecourse->course->enrolls()->count()); ?> students enrolled
                                                            </a>
                                                        </h5>
                                                    </li>
                                                    <li><h5><i class="glyphicon glyphicon-usd"></i><?php echo e(($usercreatecourse->course->cost == 0) ? "FREE" : $usercreatecourse->course->cost." VND"); ?></h5></li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="choose">
                                            <ul class="nav nav-pills nav-justified">
                                                <li><h5><a href="javascript:void(0)" class="editCourse" getId="<?php echo e($usercreatecourse->course->id); ?>"><i class="glyphicon glyphicon-edit"></i> Edit</a></h5></li>
                                                <li><h5 style="padding-left: 47px;"><a href="javascript:void(0)" class="deleteCourse" getId="<?php echo e($usercreatecourse->course->id); ?>" del="<?php echo e($usercreatecourse->can_delete); ?>"><i class="glyphicon glyphicon-trash"></i> Delete</a></h5></li>
                                            </ul>
                                        </div>
                                        <div class="choose">
                                            <div class="boss" style="text-align: center; padding:10px;">
                                                <?php echo ($usercreatecourse->isBoss)?"You have ".$usercreatecourse->course->membercreatecourses()->count()." members":"Owner is <a href=''>".$usercreatecourse->course->bosscreatecourse()->user->fullname."</a>"; ?>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <?php endforeach; ?>
                        <?php else: ?>
                            <p style="text-align: center; font-size: 16px;">You haven't create any course yet. Do you want to create course? Click <a href="<?php echo e(url('master/create-course')); ?>\">here</a></p>
                        <?php endif; ?>
                    </div>
                    <!--/panel-body-->
                </div>
                <!--/panel-->
            </div>
            <!--/row-->
        </div>
        <!--/col-span-9-->
    </div>
</div>

<?php $__env->stopSection(); ?>

<?php $__env->startSection('footer-bottom'); ?>
    <?php echo $__env->make('public.layouts.footer.footer-bottom', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('script'); ?>
    <script src="<?php echo e(url('js/master/scripts.js')); ?>"></script>
    <script type="text/javascript">

        $('a.deleteCourse').on('click',function(){
            

            var getId = $(this).attr('getId');
            var del = $(this).attr('del');
            var course = {};
            course.course_id = getId;
            course._token = '<?php echo e(csrf_token()); ?>';
            if(del=='1'){
                var r = confirm('Do you wanna delete this course?');
                if (r == true) {

                    $.ajax({
                        type: "POST",
                        url : "/master/delete-course",
                        dataType: 'json',
                        data: course, // remember that be must to pass data object type
                        success : function(response){
                            console.log(response);
                            if(response.status){
                                if(response.usercreatecourses.length){
                                    for(var i = 0; i < response.usercreatecourses.length; i++){
                                        $('div.panel-body').html(
                                            "<div class='col-sm-3'>"+
                                                "<div class='product-image-wrapper'>"+
                                                    "<div class='single-products'>"+
                                                        "<div class='productinfo text-center'>"+
                                                            "<a href='javascript:void(0)' class='thumbnail'>"+
                                                                "<img src='/"+response.usercreatecourses[i].course.image.path+"' alt='"+response.usercreatecourses[i].course.image.img_name+"' style='height: 240px;' />"+
                                                            "</a>"+
                                                            "<h2>"+response.usercreatecourses[i].course.course_name+"</h2>"+
                                                            "<ul class='nav nav-pills nav-justified'>"+
                                                                "<li><h5><a href='javascript:void(0)'><i class='glyphicon glyphicon-user'></i>"+response.usercreatecourses[i].course.enrolls.length+" students enrolled</a></h5></li>"+
                                                                "<li><h5><i class='glyphicon glyphicon-usd'></i>"+response.usercreatecourses[i].course.cost+"</h5></li>"+
                                                            "</ul>"+
                                                        "</div>"+
                                                    "</div>"+
                                                    "<div class='choose'>"+
                                                        "<ul class='nav nav-pills nav-justified'>"+
                                                            "<li><h5><a href='javascript:void(0)'><i class='glyphicon glyphicon-edit'></i> Edit</a></h5></li>"+
                                                            "<li><h5 style='padding-left: 47px;'><a href='javascript:void(0)' class='deleteCourse' getId='"+response.usercreatecourses[i].course.id+"'><i class='glyphicon glyphicon-trash'></i> Delete</h5></a></li>"+
                                                        "</ul>"+
                                                    "</div>"+
                                               "</div>"+
                                            "</div>"
                                        );
                                    }
                                }else{
                                    $('div.panel-body').html(" Nothing to show");
                                }
                                var n = noty({text: response.message, layout: 'top', type: 'success', template: '<div class="noty_message"><span class="noty_text"></span><div class="noty_close"></div></div>', closeWith: ['button'], timeout:2000 });
                            }else{
                                var n = noty({text: response.message, layout: 'top', type: 'error', template: '<div class="noty_message"><span class="noty_text"></span><div class="noty_close"></div></div>', closeWith: ['button'], timeout:2000 });
                            }
                        }
                    });
                }
            }else{
                var n = noty({text: "You dont have permission to delete this course. Ask owner to able to do this", layout: 'top', type: 'error', template: '<div class="noty_message"><span class="noty_text"></span><div class="noty_close"></div></div>', closeWith: ['button'], timeout:2000 });

            }
        });
        $('a.editCourse').on('click',function(){
            
            var getId = $(this).attr('getId');
            window.location.href = "/master/edit-course/" + getId;
        });
    </script>
<?php $__env->stopSection(); ?>


<?php echo $__env->make('public.layouts.app', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>